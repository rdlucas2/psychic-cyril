<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <script src="js/vendor/modernizr-2.6.2.min.js"></script>
    <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>

    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
        var socket = io.connect(window.location.hostname);
        var unique = "";

        var msgRecieved = "";
        var userRecieved = "";
        socket.on('user', function (data) {
            userRecieved = data["user"];
        });

        socket.on('sent', function (data) {
            msgRecieved = data["sent"];
            $("#main").prepend('<div class="' + unique + 'message"><span class="' + unique + 'user">' + userRecieved + ' says: </span><span class="' + unique + 'sent">' + msgRecieved + '</span></div>')
        });

        var name = "";
        socket.on('loggedin', function (data) {
            name = data['loggedin'];
            $("#main").prepend('<div class="' + unique + 'message"><span class="' + unique + 'user">' + name + '</span><span class="' + unique + 'sent"> has connected...</span></div>');
        });

        socket.on('connect', function () {
            socket.emit('set nickname', prompt('What is your nickname?'));
            socket.on('ready', function () {
                $("#SEND").click(function () {
                    socket.emit('msg', $("#TEXT").val());
                    unique = Math.random();
                    $('#TEXT').val("");
                });
                $('#TEXT').bind('keyup', function (e) {

                    if (e.keyCode === 13) { // 13 is enter key
                        socket.emit('msg', $("#TEXT").val());
                        unique = Math.random();
                        $('#TEXT').val("");
                    }
                });
            });
        });

        socket.on('disconnecting', function (data) {
            $("#main").prepend('<div class="' + unique + 'message"><span class="' + unique + 'user">' + data['user'] + '</span><span class="' + unique + 'sent"> has disconnected...</span></div>');
        });

        socket.on('userlist', function (data) {
            console.log(data)
            $('#USERS').empty();
            $.each(data, function (key, value) {
                $('#USERS').append('<div>' + key + '</div>');
            });
        });

    </script>
    <style type="text/css">
        /* Ryan Lucas Custom Styles */
        #main {
            height: 220px;
            overflow: auto;
        }
    </style>
</head>
<body>
    <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

    <!-- Add your site or application content here -->

    <div id="main">
        <div class="message">
            <span class="user"></span><span class="sent"></span>
        </div>
    </div>

    <textarea id="TEXT" name="text" rows="10" cols="60"></textarea>
    <input type="submit" value="Send" name="submit" id="SEND" />
    <div id="USERS"></div>

    <hr />

    <form action="/upload" method="post">
        <textarea id="box" name="text" rows="20" cols="60"></textarea>
        <input type="submit" value="Submit" name="submit" id="SUBMIT" />
    </form>
</body>
</html>
